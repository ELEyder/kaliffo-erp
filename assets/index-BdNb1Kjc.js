import{r as p,Z as T,$ as R,E as V,H as z,a0 as $,f as B,a1 as U,p as q,l as L,F as n,j as e,X as O,S as f,a2 as N,a3 as w,B as v,I as b}from"./index-Bunp8VmX.js";import{A as C}from"./ApiClient-CwTlTqVt.js";import{u as Y}from"./useTiendas-DooPxEv9.js";import{u as G}from"./useProductos-B_dEi9oV.js";import{M as k}from"./index-DCZRlB0p.js";import{C as A}from"./index-BD1DMr01.js";import{D as S}from"./index-B_8r9Za8.js";import{c as W}from"./Table-azPtpNCw.js";import{R as H}from"./index-B00MmLCC.js";import{h as K}from"./moment-C5S46NFB.js";import{u as X}from"./useApiRequest-GF_nNgjO.js";import{T as Z}from"./index-1LFFKiN5.js";import{F as J}from"./index-qnTMOKQ7.js";import{P as Q}from"./index-BYkL8nB6.js";import"./ActionButton-DynUVMgy.js";import"./index-BkpqA939.js";import"./Skeleton-DQ75DhjH.js";import"./styleChecker-BYYi54FN.js";import"./index-CWZRQiGq.js";import"./Dropdown-CAg5ab4S.js";import"./gapSize-U1swVQyS.js";import"./scrollTo-CK3_7m1G.js";import"./useBreakpoint-RvYD15SG.js";const{Option:D}=T;function M(a){return(a==null?void 0:a.type)&&(a.type.isSelectOption||a.type.isSelectOptGroup)}const ee=(a,s)=>{var l;const{prefixCls:c,className:i,popupClassName:x,dropdownClassName:h,children:m,dataSource:y}=a,g=R(m);let t;g.length===1&&p.isValidElement(g[0])&&!M(g[0])&&([t]=g);const u=t?()=>t:void 0;let r;g.length&&M(g[0])?r=m:r=y?y.map(j=>{if(p.isValidElement(j))return j;switch(typeof j){case"string":return p.createElement(D,{key:j,value:j},j);case"object":{const{value:E}=j;return p.createElement(D,{key:E,value:E},j.text)}default:return}}):[];const{getPrefixCls:o}=p.useContext(V),d=o("select",c),[_]=z("SelectLike",(l=a.dropdownStyle)===null||l===void 0?void 0:l.zIndex);return p.createElement(T,Object.assign({ref:s,suffixIcon:null},$(a,["dataSource","dropdownClassName"]),{prefixCls:d,popupClassName:x||h,dropdownStyle:Object.assign(Object.assign({},a.dropdownStyle),{zIndex:_}),className:B(`${d}-auto-complete`,i),mode:T.SECRET_COMBOBOX_MODE_DO_NOT_USE,getInputElement:u}),r)},I=p.forwardRef(ee),te=U(I);I.Option=D;I._InternalPanelDoNotUseOrYouWillBeFired=te;var ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},re=function(s,l){return p.createElement(q,L({},s,{ref:l,icon:ae}))},se=p.forwardRef(re);const F=async(a,s)=>{try{const{data:l}=await C.get(`/compra/detalle/${s}`);a(l)}catch(l){console.error("Error al obtener el detalle de la compra:",l)}},le=async a=>{try{const{data:s}=await C.get("/compra/empresas");a(s)}catch(s){console.error("Error al obtener las empresas:",s)}},oe=async a=>{try{const{data:s}=await C.get("/compra/productos");a(s)}catch(s){console.error("Error al obtener los productos:",s)}},ne=async a=>{const s={empresa_proveedor:a.empresa,fecha_compra:a.fecha_compra,cantidad:a.cantidad_total,total:a.total_neto,tienda_id:a.tienda,detalle:a.detalle};try{return await C.post("/compra/create",s),"Compra añadida exitosamente"}catch{return"Error al añadir la compra"}},ie=async(a,s,l)=>{const c={};for(const i in l)if(s[i]!==l[i]&&s[i]!==void 0&&(c[i]=s[i],i==="detalle")){c.detalle=[];for(let x=0;x<l.detalle.length;x++){const h=l.detalle[x],m=s.detalle[x],y={};for(const g in h)m[g]!==h[g]&&(y[g]=m[g]);Object.keys(y).length>0&&c.detalle.push({compraDetalle_id:h.compraDetalle_id,...y})}}try{await C.put(`/compra/update/${a}`,c),console.log("Compra actualizada exitosamente")}catch{console.log("Error al actualizar la compra")}},de=a=>{const{handleRequest:s,loading:l,error:c}=X(a),[i,x]=p.useState({});return{compra:i,loading:l,error:c,getCompra:async t=>{t&&await s(async()=>{const u=await C.get(`/compra/${t}`);x(u.data)})},addCompra:async t=>{const u={nombre:t.nombre,ap_paterno:t.ap_paterno,ap_materno:t.ap_materno,fecha_nacimiento:t.fecha_nacimiento.format("YYYY-MM-DD"),dni:t.dni,telefono:t.telefono,sueldo:t.sueldo,rol:t.rol,tienda_id:t.tienda_id??1};await s(()=>C.post("/compra/create",u),"Compra agregado")},updateCompra:async(t,u)=>{u.tienda_id=u.rol!=1?1:u.rol,console.log(u),await s(()=>C.put(`/compra/update/${t}`,u),"Compra actualizado")},deleteCompra:async t=>{await s(async()=>{await C.delete(`/compra/delete/${t}`),x({})},"Compra eliminado")}}},ce=()=>{const[a,s]=p.useState([]),[l,c]=p.useState(!1),[i,x]=p.useState(null),h=async()=>{c(!0);try{const m=await C.get("compra");s(m.data)}catch(m){x(m)}finally{c(!1)}};return p.useEffect(()=>{(async()=>{await h()})()},[]),{compras:a,loading:l,error:i,getCompras:h}},pe=()=>{const[a,s]=p.useState([]),[l,c]=p.useState(!1),[i,x]=p.useState(null),h=async()=>{c(!0);try{const m=await C.get("/compra/empresas");s(m.data)}catch(m){x(m)}finally{c(!1)}};return p.useEffect(()=>{(async()=>{await h()})()},[]),{empresas:a,loading:l,error:i,getEmpresas:h}},me=({openModal:a,closeModal:s,reload:l,setReload:c})=>{const[i]=n.useForm(),{tiendas:x}=Y(),{productos:h}=G(),{empresas:m}=pe(),y=t=>{const u=t.reduce((o,d)=>o+((d==null?void 0:d.cantidad)||0),0),r=t.reduce((o,d)=>o+((d==null?void 0:d.total)||0),0);i.setFieldsValue({cantidad_total:u,total_neto:r})},g=async t=>{await ne(t),c(!l),s(!1),i.resetFields()};return e.jsx(k,{forceRender:!0,getContainer:!1,title:"Añadir nueva compra",open:a,onCancel:()=>s(!1),style:{textTransform:"uppercase"},okText:"Añadir",onOk:i.submit,centered:!0,width:800,children:e.jsxs(n,{style:{maxWidth:700,margin:"0 auto",marginTop:"30px"},size:"large",form:i,layout:"vertical",labelAlign:"left",id:"formulariocrear",onFinish:g,initialValues:{detalle:[{}]},onValuesChange:(t,u)=>{y(u.detalle)},children:[e.jsxs(O,{gutter:24,style:{textAlign:"center"},children:[e.jsx(f,{span:17,children:e.jsxs(A,{title:"Datos compra",style:{width:"100%",textAlign:"center"},children:[e.jsxs(O,{gutter:16,children:[e.jsx(f,{span:12,children:e.jsx(n.Item,{label:"Tienda",name:"tienda",rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(T,{options:x.map(t=>({value:t.tienda_id,label:t.tienda,key:t.tienda_id}))})})}),e.jsx(f,{span:12,children:e.jsx(n.Item,{label:"Empresa",name:"empresa",rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(I,{options:m.map(t=>({value:t.empresa_proveedor,label:t.empresa_proveedor})),filterOption:(t,u)=>{var r;return((r=u==null?void 0:u.value)==null?void 0:r.toUpperCase().indexOf(t.toUpperCase()))!==-1}})})})]}),e.jsx(n.Item,{label:"Fecha Compra",name:"fecha_compra",rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(N,{style:{width:"100%"}})})]})}),e.jsx(f,{span:7,style:{textAlign:"center"},children:e.jsxs(A,{title:"Datos Total",style:{width:"100%",textAlign:"center"},children:[e.jsx(n.Item,{label:"Cantidad",name:"cantidad_total",children:e.jsx(w,{placeholder:"Cantidad",style:{width:"100%"},readOnly:!0})}),e.jsx(n.Item,{label:"Total",name:"total_neto",children:e.jsx(w,{placeholder:"Total",style:{width:"100%"},readOnly:!0})})]})})]}),e.jsx(S,{style:{borderColor:"black"}}),e.jsx(n.List,{name:"detalle",children:(t,{add:u,remove:r})=>e.jsxs(e.Fragment,{children:[t.map(({key:o,name:d,..._})=>e.jsxs(W,{style:{display:"flex",marginBottom:8,justifyContent:"space-between"},align:"baseline",children:[e.jsx(n.Item,{..._,name:[d,"producto"],rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(I,{style:{width:"240px"},placeholder:"Nombre del Producto",options:h.map(j=>({value:j.producto,label:j.producto})),filterOption:(j,E)=>{var P;return((P=E==null?void 0:E.value)==null?void 0:P.toUpperCase().indexOf(j.toUpperCase()))!==-1}})}),e.jsx(n.Item,{..._,name:[d,"cantidad"],rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(w,{placeholder:"Cantidad",style:{width:"100%"}})}),e.jsx(n.Item,{..._,name:[d,"total"],rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(w,{placeholder:"Total",style:{width:"100%"}})}),t.length>1&&e.jsx(se,{onClick:()=>r(d)})]},o)),e.jsx(n.Item,{children:e.jsx(v,{type:"dashed",onClick:()=>u(),block:!0,icon:e.jsx(H,{}),style:{marginTop:"10px"},children:"Añadir producto"})})]})})]})})},ue=({openModal:a,closeModal:s,idC:l})=>{const[c,i]=p.useState(null);return p.useEffect(()=>{l&&F(i,l)},[l]),e.jsx(k,{forceRender:!0,getContainer:!1,title:`Detalles Compra ${l}`,open:a,onCancel:()=>s(!1),styles:{header:{textAlign:"center"}},style:{textTransform:"uppercase"},okButtonProps:{style:{display:"none"}},centered:!0,width:800,children:c?e.jsxs(n,{style:{maxWidth:700,margin:"0 auto",marginTop:"30px"},size:"large",layout:"vertical",labelAlign:"left",initialValues:{tienda:c.tienda,empresa:c.empresa_proveedor,fecha_compra:c.fecha_compra,cantidad_total:c.cantidad,total_neto:c.total},children:[e.jsxs(O,{gutter:24,style:{textAlign:"center"},children:[e.jsx(f,{span:17,children:e.jsxs(A,{title:"Datos de la Compra",style:{width:"100%",border:"solid 1px",textAlign:"center"},children:[e.jsxs(O,{gutter:16,children:[e.jsx(f,{span:12,children:e.jsx(n.Item,{label:"Tienda",name:"tienda",children:e.jsx(b,{readOnly:!0,style:{textAlign:"center"}})})}),e.jsx(f,{span:12,children:e.jsx(n.Item,{label:"Empresa",name:"empresa",children:e.jsx(b,{readOnly:!0,style:{textAlign:"center"}})})})]}),e.jsx(n.Item,{label:"Fecha Compra",name:"fecha_compra",children:e.jsx(b,{readOnly:!0,style:{textAlign:"center"}})})]})}),e.jsx(f,{span:7,style:{textAlign:"center"},children:e.jsxs(A,{title:"Datos Total",style:{width:"100%",border:"solid 1px",textAlign:"center"},children:[e.jsx(n.Item,{label:"Cantidad",name:"cantidad_total",children:e.jsx(b,{style:{width:"100%",textAlign:"center"},readOnly:!0})}),e.jsx(n.Item,{label:"Total",name:"total_neto",children:e.jsx(b,{style:{width:"100%",textAlign:"center"},readOnly:!0})})]})})]}),e.jsx(S,{style:{borderColor:"black"}}),c.detalle.map((x,h)=>e.jsxs(O,{gutter:16,children:[e.jsx(f,{span:12,children:e.jsx(n.Item,{label:"Producto",children:e.jsx(b,{value:x.producto,readOnly:!0,style:{textAlign:"center"}})})}),e.jsx(f,{span:6,children:e.jsx(n.Item,{label:"Cantidad",children:e.jsx(b,{value:x.cantidad,readOnly:!0,style:{width:"100%",textAlign:"center"}})})}),e.jsx(f,{span:6,children:e.jsx(n.Item,{label:"Total",children:e.jsx(b,{value:x.total,readOnly:!0,style:{width:"100%",textAlign:"center"}})})})]},h))]}):e.jsx("p",{children:"Cargando datos..."})})},xe=({openModal:a,closeModal:s,idC:l,reload:c})=>{const[i]=n.useForm(),[x,h]=p.useState({}),[m,y]=p.useState([]),[g,t]=p.useState([]),u=(r=[])=>{const o=r.reduce((_,j)=>_+((j==null?void 0:j.cantidad)||0),0),d=r.reduce((_,j)=>_+((j==null?void 0:j.total)||0),0);i.setFieldsValue({cantidad:o,total:d})};return p.useEffect(()=>{l&&a&&(F(r=>{var o;r&&(h(r),i.setFieldsValue({tienda:r.tienda,empresa_proveedor:r.empresa_proveedor,fecha_compra:K(r.fecha_compra),cantidad:r.cantidad,total:r.total,detalle:((o=r.detalle)==null?void 0:o.map(d=>({producto:d.producto,cantidad:d.cantidad,total:d.total,compraDetalle_id:d.compraDetalle_id})))||[]}))},l),le(y),oe(t))},[l,a]),e.jsx(k,{title:`Editar Compra ${l}`,open:a,style:{textAlign:"center"},onCancel:()=>s(!1),onOk:i.submit,okText:"Guardar",centered:!0,forceRender:!0,width:800,children:a&&e.jsxs(n,{form:i,size:"large",layout:"vertical",onFinish:async r=>{await ie(l,r,x),c(),s(!1)},onValuesChange:(r,o)=>{r.detalle&&u(o.detalle)},children:[e.jsxs(O,{gutter:24,children:[e.jsx(f,{span:17,children:e.jsxs(A,{title:"Datos de la Compra",children:[e.jsxs(O,{gutter:16,children:[e.jsx(f,{span:12,children:e.jsx(n.Item,{label:"Tienda",name:"tienda",children:e.jsx(b,{style:{textAlign:"center"},readOnly:!0})})}),e.jsx(f,{span:12,children:e.jsx(n.Item,{label:"Empresa",name:"empresa_proveedor",children:e.jsx(I,{style:{alignItems:"center"},options:m.map(r=>({value:r.empresa_proveedor,label:r.empresa_proveedor})),filterOption:(r,o)=>{var d;return(d=o==null?void 0:o.value)==null?void 0:d.toUpperCase().includes(r.toUpperCase())}})})})]}),e.jsx(n.Item,{label:"Fecha Compra",name:"fecha_compra",children:e.jsx(N,{style:{width:"100%"}})})]})}),e.jsx(f,{span:7,children:e.jsxs(A,{title:"Totales",children:[e.jsx(n.Item,{label:"Cantidad Total",name:"cantidad",children:e.jsx(w,{readOnly:!0,style:{width:"100%"}})}),e.jsx(n.Item,{label:"Total Neto",name:"total",children:e.jsx(w,{readOnly:!0,style:{width:"100%"}})})]})})]}),e.jsx(S,{}),e.jsx("div",{children:(i.getFieldValue("detalle")||[]).map((r,o)=>e.jsxs(O,{gutter:16,children:[e.jsx(f,{span:12,children:e.jsx(n.Item,{label:"Producto",name:["detalle",o,"producto"],initialValue:r.producto,children:e.jsx(I,{options:g.map(d=>({value:d.producto,label:d.producto}))})})}),e.jsx(f,{span:6,children:e.jsx(n.Item,{label:"Cantidad",name:["detalle",o,"cantidad"],initialValue:r.cantidad,children:e.jsx(w,{min:0,style:{width:"100%"}})})}),e.jsx(f,{span:6,children:e.jsx(n.Item,{label:"Total",name:["detalle",o,"total"],initialValue:r.total,children:e.jsx(w,{min:0,style:{width:"100%"}})})}),e.jsx(n.Item,{name:["detalle",o,"compraDetalle_id"],initialValue:r.compraDetalle_id,children:e.jsx(b,{type:"hidden"})})]},r.compraDetalle_id||o))})]})})},he=()=>{const{compras:a,loading:s,getCompras:l}=ce(),{deleteCompra:c}=de(l),[i,x]=p.useState(null),[h,m]=p.useState(!1),[y,g]=p.useState({dllC:!1,updC:!1,addC:!1}),t=(r,o)=>{g(d=>({...d,[r]:o}))},u=[{title:"Tienda",dataIndex:"tienda"},{title:"Empresa Provedora",dataIndex:"empresa_proveedor"},{title:"Fecha Compra",dataIndex:"fecha_compra"},{title:"Cantidad",dataIndex:"cantidad"},{title:"Total Neto",dataIndex:"total"},{title:"Opciones",dataIndex:"Opciones",render:r=>e.jsxs(O,{gutter:[8,8],justify:"center",align:"middle",className:"opciones-botones",children:[e.jsx(f,{children:e.jsx(v,{type:"primary",onClick:o=>{o.stopPropagation(),x(r.compra_id),t("updC",!0)},block:!0,children:"Editar"})}),e.jsx(f,{children:e.jsx(v,{type:"primary",onClick:o=>{o.stopPropagation(),x(r.compra_id),t("dll",!0)},children:"+"})}),e.jsx(f,{children:e.jsx(Q,{title:"ELIMINAR",description:"¿DESEA ELIMINAR ESTA COMPRA?",okText:"Confirmar",onConfirm:o=>{o.stopPropagation(),c(r.compra_id),m(!h)},cancelText:"NO",children:e.jsx(v,{block:!0,style:{background:"#f54242",color:"white"},danger:!0,onClick:o=>{o.stopPropagation(),m(!h)},children:"Eliminar"})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(J,{tooltip:"Añadir Nuevo",onClick:()=>t("addC",!0)}),e.jsx(Z,{columnas:u,rowKey:"compra_id",dataSource:a,loading:s}),e.jsx(me,{openModal:y.addC,closeModal:()=>t("addC",!1),reload:h,setReload:m}),e.jsx(ue,{openModal:y.dllC,closeModal:()=>t("dllC",!1),reload:()=>m(!h),idC:i}),e.jsx(xe,{openModal:y.updC,closeModal:()=>t("updC",!1),reload:()=>m(!h),idC:i})]})},ze=()=>e.jsxs(e.Fragment,{children:[e.jsx(S,{children:"COMPRAS"}),e.jsx(he,{})]});export{ze as default};
