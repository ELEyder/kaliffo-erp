import{r as d,C as U,v as $,c as q,I as L,a as G,j as e}from"./index-CVbCT0l5.js";import{a as v}from"./ApiClient-CULQ52Ii.js";import{g as W}from"./Tienda-CgK9HzvW.js";import{F as s}from"./index-AB0PUNYF.js";import{M as N}from"./index-C_KmYm4B.js";import{R as _,C as m}from"./row-CzRmizyp.js";import{C as E}from"./index-Dsvk128_.js";import{S}from"./index-BhSnBzJY.js";import{t as K,o as H}from"./useSize-zAnCzYCD.js";import{g as X}from"./responsiveObserver-CLScrf4w.js";import{D as V}from"./index-DLneYuss.js";import{T as O}from"./index-BDOeevcj.js";import{D as k}from"./index-Dhe16Acy.js";import{S as Y}from"./index-tbJP58fR.js";import{B as A}from"./button-DfgpAk1h.js";import{R as Z}from"./index-Bkui5ax7.js";import{I as b}from"./index-CXbtJAhA.js";import{h as J}from"./moment-COTGZkLr.js";import{F as Q}from"./index-WQRKhCfL.js";import{F as ee}from"./Table-Czjr3Miv.js";import{P as te}from"./index-CY0FoLSo.js";import"./ContextIsolator-BDuV7uS_.js";import"./EllipsisOutlined-DlXNZPqD.js";import"./useMergedState-fGtj9LVw.js";import"./index-L4NGzRYx.js";import"./ActionButton-CywvW73d.js";import"./Skeleton-CXWlOTf-.js";import"./TextArea-Cl1KOnKG.js";import"./CheckOutlined-JcE4lr5y.js";import"./DownOutlined-Bi8IMX8W.js";import"./gapSize-U1swVQyS.js";import"./Dropdown-D-1DQADy.js";import"./EyeOutlined-BxNeC4-a.js";import"./scrollTo-B3cXvMnm.js";import"./styleChecker-DScY0sRB.js";import"./addEventListener-CvtMWzaB.js";import"./index-CS-4uwXW.js";import"./LeftOutlined-DiBxhoT3.js";import"./index-DC-dasep.js";import"./useBreakpoint-BGM5iO-x.js";const{Option:P}=S;function R(a){return(a==null?void 0:a.type)&&(a.type.isSelectOption||a.type.isSelectOptGroup)}const ae=(a,l)=>{var n;const{prefixCls:p,className:c,popupClassName:x,dropdownClassName:j,children:f,dataSource:y}=a,u=K(f);let h;u.length===1&&d.isValidElement(u[0])&&!R(u[0])&&([h]=u);const g=h?()=>h:void 0;let t;u.length&&R(u[0])?t=f:t=y?y.map(i=>{if(d.isValidElement(i))return i;switch(typeof i){case"string":return d.createElement(P,{key:i,value:i},i);case"object":{const{value:w}=i;return d.createElement(P,{key:w,value:w},i.text)}default:return}}):[];const{getPrefixCls:r}=d.useContext(U),o=r("select",p),[C]=$("SelectLike",(n=a.dropdownStyle)===null||n===void 0?void 0:n.zIndex);return d.createElement(S,Object.assign({ref:l,suffixIcon:null},H(a,["dataSource","dropdownClassName"]),{prefixCls:o,popupClassName:x||j,dropdownStyle:Object.assign(Object.assign({},a.dropdownStyle),{zIndex:C}),className:q(`${o}-auto-complete`,c),mode:S.SECRET_COMBOBOX_MODE_DO_NOT_USE,getInputElement:g}),t)},I=d.forwardRef(ae),re=X(I);I.Option=P;I._InternalPanelDoNotUseOrYouWillBeFired=re;var le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},oe=function(l,n){return d.createElement(L,G({},l,{ref:n,icon:le}))},se=d.forwardRef(oe);const ne=async a=>{try{const{data:l}=await v.get("/compra");a(l)}catch(l){console.error("Error al obtener las compras:",l)}},M=async(a,l)=>{try{const{data:n}=await v.get(`/compra/detalle/${l}`);a(n)}catch(n){console.error("Error al obtener el detalle de la compra:",n)}},z=async a=>{try{const{data:l}=await v.get("/compra/empresas");a(l)}catch(l){console.error("Error al obtener las empresas:",l)}},B=async a=>{try{const{data:l}=await v.get("/compra/productos");a(l)}catch(l){console.error("Error al obtener los productos:",l)}},ie=async a=>{const l={empresa_proveedor:a.empresa,fecha_compra:a.fecha_compra,cantidad:a.cantidad_total,total:a.total_neto,tienda_id:a.tienda,detalle:a.detalle};try{return await v.post("/compra/create",l),"Compra añadida exitosamente"}catch{return"Error al añadir la compra"}},de=async a=>{try{return await v.delete(`/compra/delete/${a}`),"Compra eliminada exitosamente";return!0}catch{return"Error al eliminar la compra"}},ce=async(a,l,n)=>{const p={};for(const c in n)if(l[c]!==n[c]&&l[c]!==void 0&&(p[c]=l[c],c==="detalle")){p.detalle=[];for(let x=0;x<n.detalle.length;x++){const j=n.detalle[x],f=l.detalle[x],y={};for(const u in j)f[u]!==j[u]&&(y[u]=f[u]);Object.keys(y).length>0&&p.detalle.push({compraDetalle_id:j.compraDetalle_id,...y})}}try{await v.put(`/compra/update/${a}`,p),console.log("Compra actualizada exitosamente")}catch{console.log("Error al actualizar la compra")}},pe=({openModal:a,closeModal:l,reload:n,setReload:p})=>{const[c]=s.useForm(),[x,j]=d.useState([]),[f,y]=d.useState([]),[u,h]=d.useState([]),g=t=>{const r=t.reduce((C,i)=>C+((i==null?void 0:i.cantidad)||0),0),o=t.reduce((C,i)=>C+((i==null?void 0:i.total)||0),0);c.setFieldsValue({cantidad_total:r,total_neto:o})};return d.useEffect(()=>{W(j),z(y),B(h)},[]),e.jsx(N,{forceRender:!0,getContainer:!1,title:"Añadir nueva compra",open:a,onCancel:()=>l(!1),style:{textTransform:"uppercase"},okText:"Añadir",onOk:c.submit,centered:!0,width:800,children:e.jsxs(s,{style:{maxWidth:700,margin:"0 auto",marginTop:"30px"},size:"large",form:c,layout:"vertical",labelAlign:"left",id:"formulariocrear",onFinish:async t=>{await ie(t),p(!n),l(!1),c.resetFields()},initialValues:{detalle:[{}]},onValuesChange:(t,r)=>{g(r.detalle)},children:[e.jsxs(_,{gutter:24,style:{textAlign:"center"},children:[e.jsx(m,{span:17,children:e.jsxs(E,{title:"Datos compra",style:{width:"100%",textAlign:"center"},children:[e.jsxs(_,{gutter:16,children:[e.jsx(m,{span:12,children:e.jsx(s.Item,{label:"Tienda",name:"tienda",rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(S,{options:x.map(t=>({value:t.tienda_id,label:t.tienda,key:t.tienda_id}))})})}),e.jsx(m,{span:12,children:e.jsx(s.Item,{label:"Empresa",name:"empresa",rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(I,{options:f.map(t=>({value:t.empresa_proveedor,label:t.empresa_proveedor})),filterOption:(t,r)=>{var o;return((o=r==null?void 0:r.value)==null?void 0:o.toUpperCase().indexOf(t.toUpperCase()))!==-1}})})})]}),e.jsx(s.Item,{label:"Fecha Compra",name:"fecha_compra",rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(V,{style:{width:"100%"}})})]})}),e.jsx(m,{span:7,style:{textAlign:"center"},children:e.jsxs(E,{title:"Datos Total",style:{width:"100%",textAlign:"center"},children:[e.jsx(s.Item,{label:"Cantidad",name:"cantidad_total",children:e.jsx(O,{placeholder:"Cantidad",style:{width:"100%"},readOnly:!0})}),e.jsx(s.Item,{label:"Total",name:"total_neto",children:e.jsx(O,{placeholder:"Total",style:{width:"100%"},readOnly:!0})})]})})]}),e.jsx(k,{style:{borderColor:"black"}}),e.jsx(s.List,{name:"detalle",children:(t,{add:r,remove:o})=>e.jsxs(e.Fragment,{children:[t.map(({key:C,name:i,...w})=>e.jsxs(Y,{style:{display:"flex",marginBottom:8,justifyContent:"space-between"},align:"baseline",children:[e.jsx(s.Item,{...w,name:[i,"producto"],rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(I,{style:{width:"240px"},placeholder:"Nombre del Producto",options:u.map(T=>({value:T.producto,label:T.producto})),filterOption:(T,D)=>{var F;return((F=D==null?void 0:D.value)==null?void 0:F.toUpperCase().indexOf(T.toUpperCase()))!==-1}})}),e.jsx(s.Item,{...w,name:[i,"cantidad"],rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(O,{placeholder:"Cantidad",style:{width:"100%"}})}),e.jsx(s.Item,{...w,name:[i,"total"],rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(O,{placeholder:"Total",style:{width:"100%"}})}),t.length>1&&e.jsx(se,{onClick:()=>o(i)})]},C)),e.jsx(s.Item,{children:e.jsx(A,{type:"dashed",onClick:()=>r(),block:!0,icon:e.jsx(Z,{}),style:{marginTop:"10px"},children:"Añadir producto"})})]})})]})})},me=({openModal:a,closeModal:l,idC:n})=>{const[p,c]=d.useState(null);return d.useEffect(()=>{n&&M(c,n)},[n]),e.jsx(N,{forceRender:!0,getContainer:!1,title:`Detalles Compra ${n}`,open:a,onCancel:()=>l(!1),styles:{header:{textAlign:"center"}},style:{textTransform:"uppercase"},okButtonProps:{style:{display:"none"}},centered:!0,width:800,children:p?e.jsxs(s,{style:{maxWidth:700,margin:"0 auto",marginTop:"30px"},size:"large",layout:"vertical",labelAlign:"left",initialValues:{tienda:p.tienda,empresa:p.empresa_proveedor,fecha_compra:p.fecha_compra,cantidad_total:p.cantidad,total_neto:p.total},children:[e.jsxs(_,{gutter:24,style:{textAlign:"center"},children:[e.jsx(m,{span:17,children:e.jsxs(E,{title:"Datos de la Compra",style:{width:"100%",border:"solid 1px",textAlign:"center"},children:[e.jsxs(_,{gutter:16,children:[e.jsx(m,{span:12,children:e.jsx(s.Item,{label:"Tienda",name:"tienda",children:e.jsx(b,{readOnly:!0,style:{textAlign:"center"}})})}),e.jsx(m,{span:12,children:e.jsx(s.Item,{label:"Empresa",name:"empresa",children:e.jsx(b,{readOnly:!0,style:{textAlign:"center"}})})})]}),e.jsx(s.Item,{label:"Fecha Compra",name:"fecha_compra",children:e.jsx(b,{readOnly:!0,style:{textAlign:"center"}})})]})}),e.jsx(m,{span:7,style:{textAlign:"center"},children:e.jsxs(E,{title:"Datos Total",style:{width:"100%",border:"solid 1px",textAlign:"center"},children:[e.jsx(s.Item,{label:"Cantidad",name:"cantidad_total",children:e.jsx(b,{style:{width:"100%",textAlign:"center"},readOnly:!0})}),e.jsx(s.Item,{label:"Total",name:"total_neto",children:e.jsx(b,{style:{width:"100%",textAlign:"center"},readOnly:!0})})]})})]}),e.jsx(k,{style:{borderColor:"black"}}),p.detalle.map((x,j)=>e.jsxs(_,{gutter:16,children:[e.jsx(m,{span:12,children:e.jsx(s.Item,{label:"Producto",children:e.jsx(b,{value:x.producto,readOnly:!0,style:{textAlign:"center"}})})}),e.jsx(m,{span:6,children:e.jsx(s.Item,{label:"Cantidad",children:e.jsx(b,{value:x.cantidad,readOnly:!0,style:{width:"100%",textAlign:"center"}})})}),e.jsx(m,{span:6,children:e.jsx(s.Item,{label:"Total",children:e.jsx(b,{value:x.total,readOnly:!0,style:{width:"100%",textAlign:"center"}})})})]},j))]}):e.jsx("p",{children:"Cargando datos..."})})},ue=({openModal:a,closeModal:l,idC:n,reload:p})=>{const[c]=s.useForm(),[x,j]=d.useState({}),[f,y]=d.useState([]),[u,h]=d.useState([]),g=(t=[])=>{const r=t.reduce((C,i)=>C+((i==null?void 0:i.cantidad)||0),0),o=t.reduce((C,i)=>C+((i==null?void 0:i.total)||0),0);c.setFieldsValue({cantidad:r,total:o})};return d.useEffect(()=>{n&&a&&(M(t=>{var r;t&&(j(t),c.setFieldsValue({tienda:t.tienda,empresa_proveedor:t.empresa_proveedor,fecha_compra:J(t.fecha_compra),cantidad:t.cantidad,total:t.total,detalle:((r=t.detalle)==null?void 0:r.map(o=>({producto:o.producto,cantidad:o.cantidad,total:o.total,compraDetalle_id:o.compraDetalle_id})))||[]}))},n),z(y),B(h))},[n,a]),e.jsx(N,{title:`Editar Compra ${n}`,open:a,style:{textAlign:"center"},onCancel:()=>l(!1),onOk:c.submit,okText:"Guardar",centered:!0,forceRender:!0,width:800,children:a&&e.jsxs(s,{form:c,size:"large",layout:"vertical",onFinish:async t=>{await ce(n,t,x),p(),l(!1)},onValuesChange:(t,r)=>{t.detalle&&g(r.detalle)},children:[e.jsxs(_,{gutter:24,children:[e.jsx(m,{span:17,children:e.jsxs(E,{title:"Datos de la Compra",children:[e.jsxs(_,{gutter:16,children:[e.jsx(m,{span:12,children:e.jsx(s.Item,{label:"Tienda",name:"tienda",children:e.jsx(b,{style:{textAlign:"center"},readOnly:!0})})}),e.jsx(m,{span:12,children:e.jsx(s.Item,{label:"Empresa",name:"empresa_proveedor",children:e.jsx(I,{style:{alignItems:"center"},options:f.map(t=>({value:t.empresa_proveedor,label:t.empresa_proveedor})),filterOption:(t,r)=>{var o;return(o=r==null?void 0:r.value)==null?void 0:o.toUpperCase().includes(t.toUpperCase())}})})})]}),e.jsx(s.Item,{label:"Fecha Compra",name:"fecha_compra",children:e.jsx(V,{style:{width:"100%"}})})]})}),e.jsx(m,{span:7,children:e.jsxs(E,{title:"Totales",children:[e.jsx(s.Item,{label:"Cantidad Total",name:"cantidad",children:e.jsx(O,{readOnly:!0,style:{width:"100%"}})}),e.jsx(s.Item,{label:"Total Neto",name:"total",children:e.jsx(O,{readOnly:!0,style:{width:"100%"}})})]})})]}),e.jsx(k,{}),e.jsx("div",{children:(c.getFieldValue("detalle")||[]).map((t,r)=>e.jsxs(_,{gutter:16,children:[e.jsx(m,{span:12,children:e.jsx(s.Item,{label:"Producto",name:["detalle",r,"producto"],initialValue:t.producto,children:e.jsx(I,{options:u.map(o=>({value:o.producto,label:o.producto}))})})}),e.jsx(m,{span:6,children:e.jsx(s.Item,{label:"Cantidad",name:["detalle",r,"cantidad"],initialValue:t.cantidad,children:e.jsx(O,{min:0,style:{width:"100%"}})})}),e.jsx(m,{span:6,children:e.jsx(s.Item,{label:"Total",name:["detalle",r,"total"],initialValue:t.total,children:e.jsx(O,{min:0,style:{width:"100%"}})})}),e.jsx(s.Item,{name:["detalle",r,"compraDetalle_id"],initialValue:t.compraDetalle_id,children:e.jsx(b,{type:"hidden"})})]},t.compraDetalle_id||r))})]})})},xe=()=>{const[a,l]=d.useState([]),[n,p]=d.useState(null),[c,x]=d.useState(!1),[j,f]=d.useState(!1),[y,u]=d.useState(!1),[h,g]=d.useState(!1),t=[{title:"Tienda",key:"tienda",dataIndex:"tienda",align:"center"},{title:"Empresa Provedora",key:"empresa_proveedor",dataIndex:"empresa_proveedor",align:"center"},{title:"Fecha Compra",dataIndex:"fecha_compra",key:"fecha_compra",align:"center",responsive:["sm"]},{title:"Cantidad",dataIndex:"cantidad",key:"cantidad",align:"center"},{title:"Total Neto",dataIndex:"total",key:"total",defaultSortOrder:"ascend",sorter:{compare:(r,o)=>r.total.localeCompare(o.total),multiple:2},align:"center"},{title:"Detalle",dataIndex:"",key:"f",align:"center",render:r=>e.jsx(A,{type:"primary",onClick:o=>{o.stopPropagation(),p(r.compra_id),x(!0)},children:"+"})},{title:"Opciones",dataIndex:"",key:"x",align:"center",render:r=>e.jsxs(_,{gutter:[8,8],justify:"center",align:"middle",className:"opciones-botones",children:[e.jsx(m,{children:e.jsx(A,{type:"primary",onClick:o=>{o.stopPropagation(),p(r.compra_id),f(!0)},block:!0,children:"Editar"})}),e.jsx(m,{children:e.jsx(te,{title:"ELIMINAR",description:"¿DESEA ELIMINAR ESTA COMPRA?",okText:"Confirmar",onConfirm:o=>{o.stopPropagation(),de(r.compra_id),g(!h)},cancelText:"NO",children:e.jsx(A,{block:!0,style:{background:"#f54242",color:"white"},danger:!0,onClick:o=>{o.stopPropagation(),g(!h)},children:"Eliminar"})})})]})}];return d.useEffect(()=>{ne(l)},[h]),e.jsxs(e.Fragment,{children:[e.jsx(Q,{tooltip:"Añadir Nuevo",onClick:()=>u(!0)}),e.jsx(ee,{scroll:{x:"min-content"},columns:t,pagination:{pageSize:5},dataSource:a.map((r,o)=>({...r,key:r.compra_id})),rowKey:r=>r.compra_id,bordered:!0,className:"tabla_trabajadores"}),e.jsx(pe,{openModal:y,closeModal:u,reload:h,setReload:g}),e.jsx(me,{openModal:c,closeModal:x,reload:()=>g(!h),idC:n}),e.jsx(ue,{openModal:j,closeModal:f,reload:()=>g(!h),idC:n})]})},tt=()=>e.jsxs(e.Fragment,{children:[e.jsx(k,{style:{textTransform:"uppercase"},children:"COMPRAS"}),e.jsx(xe,{reload:()=>setReload(!reload)})]});export{tt as default};
