import{r as v,F as m,c as V,j as e,X as F,S as d,I as j,B,Z as k}from"./index-Bunp8VmX.js";import{c as z}from"./Producto-BhDx9a2R.js";import{A as D}from"./ApiClient-CwTlTqVt.js";import{D as I}from"./index-B_8r9Za8.js";import{C as P}from"./index-BD1DMr01.js";import{T as R}from"./index-DokvF9RQ.js";import"./Skeleton-DQ75DhjH.js";import"./index-B00MmLCC.js";import"./Dropdown-CAg5ab4S.js";import"./styleChecker-BYYi54FN.js";const S=async(x,o,s,h,i,b,p)=>{let g={tipo:x,cantidad:h,total_b:i,total_igv:b,total_N:p,tipoPago:o.metodo,...x==="boleta"?{dni:o.dni}:{ruc:o.ruc},direccion:o.direccion,nombre:o.nombre,detalle:s};try{await D.post("/venta/create",g)}catch(y){console.log(y)}},A=async(x,o)=>{try{return(await D.get(`/venta/datos_cliente/${o}?tipo=${x}`)).data}catch(s){console.log(s)}},Z=()=>{const{Title:x,Text:o}=R,[s,h]=v.useState({}),[i,b]=v.useState(""),[p]=m.useForm(),{tipo:g}=V();v.useEffect(()=>{const r=t=>{t.key==="Enter"&&i.trim()!==""?(Object.values(s).some(a=>a.detalles.some(n=>n.codigo===i))?h(a=>{const n={...a};return Object.keys(n).forEach(l=>{n[l].detalles=n[l].detalles.map(c=>c.codigo===i?{...c,cantidad:c.cantidad+1}:c),n[l].cantidad=n[l].detalles.reduce((c,{cantidad:_})=>c+_,0)}),n}):z(i).then(a=>{a&&h(n=>{const l=[a.producto_nombre,a.nombre,a.talla].join("-"),c=n[l]?n[l].detalles.reduce((_,{cantidad:E})=>_+E,0)+1:1;return n[l]?{...n,[l]:{...n[l],cantidad:c,detalles:[...n[l].detalles,{detalle_id:a.productoDetalle_id,codigo:i,cantidad:1}]}}:{...n,[l]:{producto_id:a.producto_id,color_id:a.color_id,talla:a.talla,cantidad:c,precio:a.precioBase,detalles:[{detalle_id:a.productoDetalle_id,codigo:i,cantidad:1}]}}})}),b("")):b(u=>u+t.key)};return document.addEventListener("keypress",r),()=>{document.removeEventListener("keypress",r)}},[i]);const y=r=>{h(t=>{const{[r]:u,...a}=t;return a})},T=Object.values(s).reduce((r,{cantidad:t})=>r+t,0),f=Object.values(s).reduce((r,{cantidad:t,precio:u})=>r+t*u,0),C=Math.floor(f*.18),w=(f+C).toFixed(1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{orientation:"center",style:{textTransform:"uppercase",fontSize:"1.4rem",fontWeight:"bold",color:"#4A90E2"},children:g==="boleta"?"Boleta":"Factura"}),e.jsx(m,{size:"large",labelAlign:"left",layout:"vertical",form:p,onFinish:async r=>{await S(g,r,s,T,f,C,w)},children:e.jsxs(F,{gutter:16,children:[e.jsx(d,{span:16,children:e.jsxs(F,{children:[e.jsx(d,{span:24,children:e.jsx(x,{level:3,style:{backgroundColor:"#181c34",textAlign:"center",borderRadius:"10px",color:"#fff",padding:"10px 0"},children:"Productos"})}),e.jsx(d,{span:24,style:{marginTop:"10px",fontSize:"1rem",textAlign:"center",color:"#333",maxHeight:"250px",overflowY:"auto"},children:e.jsx("div",{id:"productos_lista",style:{color:"white"},children:Object.entries(s).map(([r,t])=>e.jsxs(F,{gutter:[16,16],style:{margin:"10px 0",padding:"10px",backgroundColor:"#1e1e2f",borderRadius:"8px",alignItems:"center"},children:[e.jsx(d,{span:10,style:{textAlign:"left",color:"#fff"},children:e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold"},children:`${r}: ${t.cantidad}`})}),e.jsx(d,{span:8,children:e.jsx(m.Item,{style:{margin:0},children:e.jsx(j,{value:t.precio,onChange:u=>{const a=parseFloat(u.target.value)||0;h(n=>({...n,[r]:{...n[r],precio:a}}))},style:{borderRadius:"5px",textAlign:"center",fontWeight:"bold"}})})}),e.jsx(d,{span:6,children:e.jsx(B,{type:"primary",danger:!0,onClick:()=>y(r),style:{width:"100%",fontWeight:"bold",borderRadius:"5px"},children:"X"})})]},r))})}),e.jsx(I,{style:{margin:"15px 0"}}),e.jsxs(d,{span:24,style:{fontSize:"0.9rem",color:"yellow",display:"flex",justifyContent:"space-between",padding:"10px",backgroundColor:"#f7f7f7",borderRadius:"8px",fontWeight:"bold"},children:[e.jsxs(o,{children:["Cantidad Total: ",T]}),e.jsxs(o,{children:["Total Bruto: ",f]}),e.jsxs(o,{children:["IGV Total: ",C]}),e.jsxs(o,{children:["Total Neto: ",w]})]})]})}),e.jsx(d,{span:1,children:e.jsx(I,{type:"vertical",style:{height:"100%",borderColor:"#e0e0e0"}})}),e.jsxs(d,{span:7,children:[e.jsxs(P,{size:"small",title:e.jsx(x,{level:4,style:{color:"white",textAlign:"center"},children:"Datos del Cliente"}),bordered:!1,children:[g==="boleta"?e.jsx(m.Item,{name:"dni",label:"DNI del Cliente",children:e.jsx(j,{maxLength:8,count:{show:!0,max:8},onChange:r=>{r.target.value.length===8&&A("dni",r.target.value).then(t=>{t?p.setFieldValue("nombre",[t.name,t.motherLastName,t.lastName].join(" ")):p.setFieldValue("nombre",[])})}})}):e.jsxs(e.Fragment,{children:[e.jsx(m.Item,{name:"ruc",label:"RUC del Cliente",children:e.jsx(j,{maxLength:11,count:{show:!0,max:11},onChange:r=>{r.target.value.length===11?A("ruc",r.target.value).then(t=>{t&&p.setFieldsValue({nombre:t.social_reason,direccion:[t.type_road,t.name_road,t.number,t.zone_code,t.type_zone].join(" ")})}):p.setFieldValue("nombre",[])}})}),e.jsx(m.Item,{name:"direccion",label:"Direccion",children:e.jsx(j,{})})]}),e.jsx(m.Item,{name:"nombre",label:"Nombre del Cliente",children:e.jsx(j,{readOnly:!0})}),e.jsx(m.Item,{name:"metodo",label:"Tipo de Pago",children:e.jsx(k,{defaultValue:"1",options:[{value:1,label:"Efectivo"},{value:2,label:"Yape/Plin"},{value:3,label:"Transferencia"}]})})]}),Object.keys(s).length>=1&&e.jsx("div",{style:{marginTop:"10px",marginBottom:"20px"},children:e.jsx(B,{type:"primary",block:!0,htmlType:"submit",children:g==="boleta"?"Imprimir Boleta":"Imprimir Factura"})})]})]})})]})};export{Z as default};
