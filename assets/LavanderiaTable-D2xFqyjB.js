import{e as I,r as s,j as e,ai as S}from"./index-VOe2vgqy.js";import{a as k,b as L}from"./Lavanderia-CVL9Jvvv.js";import{f as w}from"./Corte-BdCkil7m.js";import{a as A}from"./ApiClient-DPIxiZ71.js";import{F as n}from"./index-CC7smcAL.js";import{M as E}from"./index-Bx1_JYha.js";import{R as M,C as u}from"./row-B9VIZwhG.js";import{S as j}from"./index-MILUAy1A.js";import{T as C}from"./index-9ycKRVJ7.js";import{I as P}from"./index-DN4pQfum.js";import{B as y}from"./button-BkK1HIrY.js";import{g as T}from"./Lote-vLrWeXzX.js";import{F as q}from"./Table-CoBWn75K.js";import{F as O}from"./index-Ct8Rupll.js";import"./ContextIsolator-BCW6I3vM.js";import"./useSize-C1OhOW7A.js";import"./EllipsisOutlined-Dvj6DMPu.js";import"./useMergedState-BLg108Rf.js";import"./index-CpO96mgP.js";import"./responsiveObserver-NkQ2BBL7.js";import"./ActionButton-CE2oHsTL.js";import"./Skeleton-CmZq7VAa.js";import"./TextArea-YowM3xaT.js";import"./CheckOutlined-DNK-T4Ox.js";import"./DownOutlined-qBagt-Zf.js";import"./EyeOutlined-CS0JsWFM.js";import"./styleChecker-BQJ6aNOb.js";import"./addEventListener-D7hb8XRL.js";import"./index-BQKuC8hm.js";import"./LeftOutlined-DEy4OodB.js";import"./Dropdown-C9Rkt24_.js";import"./index-tZJnd_qH.js";import"./index-UuGXIqas.js";import"./gapSize-U1swVQyS.js";import"./scrollTo-aC46Fzqo.js";import"./useBreakpoint-C3lN_Zix.js";const R=async o=>{try{const r=await A.get("/color");o(r.data)}catch(r){console.error("Error al obtener colores por producto:",r),o([])}},V=({openModal:o,closeModal:r,reload:x})=>{const{id:l}=I(),[d]=n.useForm(),[m,v]=s.useState([]),[b,g]=s.useState([]),[h,i]=s.useState({});s.useEffect(()=>{w(l,v),R(g),i({})},[l,x]);const f=(c,_)=>{const p=m.find(a=>a.corte_id===_);p&&(i(a=>({...a,[c]:p.cantidad_restante||0})),d.setFieldsValue({detalles:d.getFieldValue("detalles").map((a,t)=>t===c?{...a,talla:p.talla}:a)}))};return e.jsx(E,{title:"Nueva Lavandería",open:o,styles:{header:{textAlign:"center"}},onCancel:()=>r(!1),onOk:d.submit,okText:"Añadir",centered:!0,width:550,children:e.jsx(n,{form:d,layout:"vertical",size:"large",labelAlign:"left",onFinish:async c=>{await k(l,c),d.resetFields(),x(),r(!1)},children:e.jsx(n.List,{name:"detalles",children:(c,{add:_,remove:p})=>e.jsxs(e.Fragment,{children:[c.map(a=>e.jsxs("div",{children:[e.jsxs(M,{gutter:{xs:8,sm:16,md:24,lg:32},children:[e.jsx(u,{span:12,children:e.jsx(n.Item,{name:[a.name,"corte_id"],label:"Corte",rules:[{required:!0,message:"Seleccione un corte"}],children:e.jsx(j,{placeholder:"Selecciona la prenda - talla",onChange:t=>f(a.name,t),children:m.map(t=>e.jsxs(j.Option,{value:t.corte_id,children:[t.producto," - ",t.talla]},t.corte_id))})})}),e.jsx(u,{span:12,children:e.jsx(n.Item,{name:[a.name,"color_id"],label:"Color",rules:[{required:!0,message:"Seleccione un color"}],children:e.jsx(j,{placeholder:"Selecciona el color",children:b.map(t=>e.jsx(j.Option,{value:t.color_id,children:t.nombre},t.nombre))})})}),e.jsx(u,{span:12,children:e.jsx(n.Item,{name:[a.name,"cantidad_enviada"],label:"Cantidad",rules:[{required:!0,message:"Ingrese la cantidad enviada"},({getFieldValue:t})=>({validator(B,F){return F>0?Promise.resolve():Promise.reject(new Error("La cantidad enviada debe ser mayor a 0"))}})],children:e.jsx(C,{style:{width:"100%"},min:0,max:h[a.name]||0,placeholder:`Máx: ${h[a.name]||"-"}`})})}),e.jsx(u,{span:12,children:e.jsx(n.Item,{name:[a.name,"precio_unidad"],label:"Precio",rules:[{required:!0,message:"Ingrese el precio por unidad"}],children:e.jsx(C,{style:{width:"100%"},min:0,placeholder:"Precio"})})}),e.jsx(u,{span:24,children:e.jsx(n.Item,{name:[a.name,"lavanderia_asignada"],label:"Lavandería",rules:[{required:!0,message:"Ingrese la lavandería asignada"}],children:e.jsx(P,{placeholder:"Lavandería Asignada"})})})]}),e.jsx(y,{type:"danger",style:{background:"red",marginBottom:"10px"},onClick:()=>p(a.name),block:!0,children:"Eliminar"})]},a)),e.jsx(n.Item,{children:e.jsx(y,{type:"dashed",onClick:()=>_(),block:!0,children:"Agregar Detalle"})})]})})})})},Ce=()=>{const{id:o}=I(),[r,x]=s.useState([]),[l,d]=s.useState([]),{reload:m,setReload:v}=S(),[b,g]=s.useState(!1);s.useEffect(()=>{L(o,x),T(o,2,d)},[o,m]),r.some(i=>i.estado===1);const h=[{key:"lavanderia_asignada",dataIndex:"lavanderia_asignada",title:"Lavanderia",align:"center"},{key:"producto",dataIndex:"producto_nombre",title:"Producto",align:"center"},{key:"color",dataIndex:"nombre",title:"Color",align:"center"},{key:"talla",dataIndex:"talla",title:"Talla",align:"center"},{key:"cantidad",dataIndex:"cantidad_enviada",title:"Cantidad",align:"center",sorter:(i,f)=>i.cantidad_enviada-f.cantidad_enviada},...r.some(i=>i.estado===3)?[{key:"cantidad_recibida",dataIndex:"cantidad_recibida",title:"Cantidad Recibida",align:"center"}]:[],{key:"fecha_envio",dataIndex:"fecha_envio",title:"Fecha de Envio",align:"center"}];return e.jsxs(e.Fragment,{children:[e.jsx(q,{dataSource:r,columns:h,rowKey:"corte_id"}),l===0||l===1?e.jsxs(e.Fragment,{children:[e.jsx(O,{style:{insetInlineStart:270},onClick:()=>g(!0),tooltip:"Añadir Corte"}),e.jsx(V,{openModal:b,closeModal:()=>g(!1),reload:()=>v(!m)})]}):null]})};export{Ce as default};
