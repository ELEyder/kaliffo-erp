import{r as c,j as e,u as P}from"./index-DqIKEBvm.js";import{g as z}from"./AlmacenProductos-BU8j9GSw.js";import{g as F}from"./Tienda-CgK9HzvW.js";import{f as N}from"./Producto-BYzNbulg.js";import{c as O}from"./MovimientosMercaderia-BmDFY9LD.js";import{F as m}from"./index-Cm4QUYMI.js";import{D as h}from"./index-B3K63KNz.js";import{R as g,C as r}from"./row-wBh7bxhe.js";import{B as T}from"./button-CMxX_IqE.js";import{C as I}from"./index-BxITxaPj.js";import{S as E}from"./index-D22LAWOy.js";import{C as W}from"./index-DoKaOer6.js";import{T as _}from"./index-B_QV8cj1.js";import{I as R}from"./index-DQsbsrmt.js";import"./ApiClient-CULQ52Ii.js";import"./ContextIsolator-BC0dw982.js";import"./useSize-DrIRUveM.js";import"./EllipsisOutlined-OfOFY1BC.js";import"./useMergedState-tmuLOH6x.js";import"./index-ZowY_pXq.js";import"./responsiveObserver-CGQIb1Op.js";import"./Skeleton-zNcnEvS7.js";import"./index-BKdF4HdI.js";import"./Dropdown-CpsOIl_T.js";import"./TextArea-wwEpy3vG.js";import"./CheckOutlined-Bv-lcQQH.js";import"./DownOutlined-C-gIk7Q9.js";import"./EditOutlined-BEiqZ6Yz.js";import"./styleChecker-DMprsIdy.js";import"./EyeOutlined-D0IlXIFP.js";const B=()=>{const{Title:x,Text:f}=_,[o,j]=c.useState({}),[n,a]=c.useState(""),[u,v]=c.useState([]),[b]=m.useForm(),[y,S]=c.useState([]),[k,V]=c.useState(!1);c.useEffect(()=>{z(v),F(S)},[k]),c.useEffect(()=>{const t=p=>{p.key==="Enter"&&n.trim()!==""?(Object.values(o).some(i=>i.detalles.some(s=>s.codigo===n))?j(i=>{const s={...i};return Object.keys(s).forEach(l=>{s[l].detalles=s[l].detalles.map(d=>d.codigo===n?{...d,cantidad:d.cantidad+1}:d),s[l].cantidad=s[l].detalles.reduce((d,{cantidad:A})=>d+A,0)}),s}):N(n,"almacen_id",b.getFieldValue("almacen")).then(i=>{i&&j(s=>{const l=[i.producto_nombre,i.nombre,i.talla].join("-"),d=s[l]?s[l].detalles.reduce((A,{cantidad:w})=>A+w,0)+1:1;return s[l]?{...s,[l]:{...s[l],cantidad:d,detalles:[...s[l].detalles,{detalle_id:i.productoDetalle_id,codigo:n,cantidad:1}]}}:{...s,[l]:{producto_id:i.producto_id,color_id:i.color_id,talla:i.talla,cantidad:d,detalles:[{detalle_id:i.productoDetalle_id,codigo:n,cantidad:1}]}}})}),a("")):a(C=>C+p.key)};return document.addEventListener("keypress",t),()=>{document.removeEventListener("keypress",t)}},[n]);const M=t=>{j(p=>{const{[t]:C,...i}=p;return i})},D=Object.values(o).flatMap(t=>t.detalles).reduce((t,{cantidad:p})=>t+p,0);return e.jsxs(e.Fragment,{children:[e.jsx(h,{children:"GENERAR MOVIMIENTO DE MERCADERIA"}),e.jsx(m,{form:b,size:"large",labelAlign:"left",layout:"vertical",onFinish:async t=>{await O(t,o)},children:e.jsxs(g,{gutter:16,children:[e.jsx(r,{span:16,children:e.jsxs(g,{children:[e.jsx(r,{span:24,children:e.jsx(x,{level:3,style:{backgroundColor:"#181c34",textAlign:"center",borderRadius:"10px",color:"#fff",padding:"10px 0"},children:"Productos"})}),e.jsx(r,{span:24,style:{marginTop:"10px",fontSize:"1rem",textAlign:"center",color:"#333",maxHeight:"250px",overflowY:"auto"},children:e.jsx("div",{id:"productos_lista",style:{color:"white"},children:Object.entries(o).map(([t,p])=>e.jsxs(g,{gutter:[16,16],style:{margin:"10px 0",padding:"10px",backgroundColor:"#1e1e2f",borderRadius:"8px",alignItems:"center"},children:[e.jsx(r,{span:10,style:{textAlign:"left",color:"#fff"},children:e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold"},children:`${t}: ${p.cantidad}`})}),e.jsx(r,{span:6,children:e.jsx(T,{type:"primary",danger:!0,onClick:()=>M(t),style:{width:"100%",fontWeight:"bold",borderRadius:"5px"},children:"X"})})]},t))})}),e.jsx(h,{style:{margin:"15px 0"}}),e.jsx(r,{span:24,style:{fontSize:"0.9rem",color:"#555",display:"flex",justifyContent:"space-between",padding:"10px",backgroundColor:"#f7f7f7",borderRadius:"8px",fontWeight:"bold"},children:e.jsxs(f,{children:["CANTIDAD TOTAL: ",D]})})]})}),e.jsx(r,{span:1,children:e.jsx(h,{type:"vertical",style:{height:"100%",borderColor:"#e0e0e0"}})}),e.jsxs(r,{span:7,children:[e.jsxs(I,{size:"small",title:e.jsx(x,{level:4,style:{color:"white",textAlign:"center"},children:"Datos del Envio"}),bordered:!1,children:[e.jsx(m.Item,{name:"almacen",label:"Almacen",rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(E,{options:u.map(t=>({value:t.almacen_id,label:t.nombre_almacen,key:t.almacen_id}))})}),e.jsx(m.Item,{label:"Tienda",name:"tienda",rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(E,{options:y.map(t=>({value:t.tienda_id,label:t.tienda,key:t.tienda_id}))})})]}),Object.keys(o).length>=1&&e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsx(m.Item,{name:"guia",valuePropName:"guiaSI",children:e.jsx(W,{children:"IMPRIMIR GUIA"})}),e.jsx(T,{type:"primary",block:!0,htmlType:"submit",children:"Enviar"})]})]})]})})]})},G=()=>{const{Title:x,Text:f}=_,[o,j]=c.useState({});c.useState("");const n=Object.values(o).reduce((a,{cantidad:u})=>a+u,0);return e.jsxs(e.Fragment,{children:[e.jsx(h,{children:"GENERAR MOVIMIENTO DE MERCADERIA"}),e.jsx(m,{size:"large",labelAlign:"left",layout:"vertical",children:e.jsxs(g,{gutter:16,children:[e.jsx(r,{span:16,children:e.jsxs(g,{children:[e.jsx(r,{span:24,children:e.jsx(x,{level:3,style:{backgroundColor:"#181c34",textAlign:"center",borderRadius:"10px",color:"#fff",padding:"10px 0"},children:"Productos"})}),e.jsx(r,{span:24,style:{marginTop:"10px",fontSize:"1rem",textAlign:"center",color:"#333",maxHeight:"250px",overflowY:"auto"},children:e.jsx("div",{id:"productos_lista",style:{color:"white"},children:Object.entries(o).map(([a,u])=>e.jsxs(g,{gutter:[16,16],style:{margin:"10px 0",padding:"10px",backgroundColor:"#1e1e2f",borderRadius:"8px",alignItems:"center"},children:[e.jsx(r,{span:10,style:{textAlign:"left",color:"#fff"},children:e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold"},children:`${a}: ${u.cantidad}`})}),e.jsx(r,{span:8,children:e.jsx(m.Item,{style:{margin:0},children:e.jsx(R,{value:u.precio,onChange:v=>{const b=parseFloat(v.target.value)||0;j(y=>({...y,[a]:{...y[a],precio:b}}))},style:{borderRadius:"5px",textAlign:"center",fontWeight:"bold"}})})}),e.jsx(r,{span:6,children:e.jsx(T,{type:"primary",danger:!0,onClick:()=>eliminarProducto(a),style:{width:"100%",fontWeight:"bold",borderRadius:"5px"},children:"X"})})]},a))})}),e.jsx(h,{style:{margin:"15px 0"}}),e.jsx(r,{span:24,style:{fontSize:"0.9rem",color:"#555",display:"flex",justifyContent:"space-between",padding:"10px",backgroundColor:"#f7f7f7",borderRadius:"8px",fontWeight:"bold"},children:e.jsxs(f,{children:["Cantidad Total: ",n]})})]})}),e.jsx(r,{span:1,children:e.jsx(h,{type:"vertical",style:{height:"100%",borderColor:"#e0e0e0"}})}),e.jsxs(r,{span:7,children:[e.jsxs(I,{size:"small",title:e.jsx(x,{level:4,style:{color:"white",textAlign:"center"},children:"Datos del Cliente"}),bordered:!1,children:[e.jsx(m.Item,{label:"Nombre del Cliente",children:e.jsx(R,{})}),e.jsx(m.Item,{label:"Tipo de Pago",children:e.jsx(E,{defaultValue:"1",options:[{value:"1",label:"Efectivo"},{value:"2",label:"Yape/Plin"},{value:"3",label:"Transferencia"}]})})]}),Object.keys(o).length>=1&&e.jsx("div",{style:{marginTop:"10px"}})]})]})})]})},be=()=>{const{user:x,login:f,logout:o}=P();return e.jsx(e.Fragment,{children:x.rol==="administrador"?e.jsx(B,{}):e.jsx(G,{})})};export{be as default};
