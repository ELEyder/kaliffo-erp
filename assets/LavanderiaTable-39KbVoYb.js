import{c as f,F as n,r as d,j as e,X as S,S as p,Z as j,a3 as C,I as k,B as I,aG as A}from"./index-Bunp8VmX.js";import{a as L,b as w}from"./Lavanderia-BA1Q3z-0.js";import{f as E}from"./Corte-DVOiRUog.js";import{A as M}from"./ApiClient-CwTlTqVt.js";import{M as P}from"./index-DCZRlB0p.js";import{g as q}from"./Lote-D_Ldw2rP.js";import{F as O}from"./Table-azPtpNCw.js";import{F as T}from"./index-qnTMOKQ7.js";import"./ActionButton-DynUVMgy.js";import"./index-BkpqA939.js";import"./Skeleton-DQ75DhjH.js";import"./styleChecker-BYYi54FN.js";import"./index-CWZRQiGq.js";import"./Dropdown-CAg5ab4S.js";import"./gapSize-U1swVQyS.js";import"./scrollTo-CK3_7m1G.js";import"./useBreakpoint-RvYD15SG.js";const V=async s=>{try{const r=await M.get("/color");s(r.data)}catch(r){console.error("Error al obtener colores por producto:",r),s([])}},B=({openModal:s,closeModal:r,reload:x})=>{const{id:i}=f(),[l]=n.useForm(),[m,v]=d.useState([]),[b,g]=d.useState([]),[h,o]=d.useState({});d.useEffect(()=>{E(i,v),V(g),o({})},[i,x]);const _=(c,y)=>{const u=m.find(a=>a.corte_id===y);u&&(o(a=>({...a,[c]:u.cantidad_restante||0})),l.setFieldsValue({detalles:l.getFieldValue("detalles").map((a,t)=>t===c?{...a,talla:u.talla}:a)}))};return e.jsx(P,{title:"Nueva Lavandería",open:s,styles:{header:{textAlign:"center"}},onCancel:()=>r(!1),onOk:l.submit,okText:"Añadir",centered:!0,width:550,children:e.jsx(n,{form:l,layout:"vertical",size:"large",labelAlign:"left",onFinish:async c=>{await L(i,c),l.resetFields(),x(),r(!1)},children:e.jsx(n.List,{name:"detalles",children:(c,{add:y,remove:u})=>e.jsxs(e.Fragment,{children:[c.map(a=>e.jsxs("div",{children:[e.jsxs(S,{gutter:{xs:8,sm:16,md:24,lg:32},children:[e.jsx(p,{span:12,children:e.jsx(n.Item,{name:[a.name,"corte_id"],label:"Corte",rules:[{required:!0,message:"Seleccione un corte"}],children:e.jsx(j,{placeholder:"Selecciona la prenda - talla",onChange:t=>_(a.name,t),children:m.map(t=>e.jsxs(j.Option,{value:t.corte_id,children:[t.producto," - ",t.talla]},t.corte_id))})})}),e.jsx(p,{span:12,children:e.jsx(n.Item,{name:[a.name,"color_id"],label:"Color",rules:[{required:!0,message:"Seleccione un color"}],children:e.jsx(j,{placeholder:"Selecciona el color",children:b.map(t=>e.jsx(j.Option,{value:t.color_id,children:t.nombre},t.nombre))})})}),e.jsx(p,{span:12,children:e.jsx(n.Item,{name:[a.name,"cantidad_enviada"],label:"Cantidad",rules:[{required:!0,message:"Ingrese la cantidad enviada"},({getFieldValue:t})=>({validator(R,F){return F>0?Promise.resolve():Promise.reject(new Error("La cantidad enviada debe ser mayor a 0"))}})],children:e.jsx(C,{style:{width:"100%"},min:0,max:h[a.name]||0,placeholder:`Máx: ${h[a.name]||"-"}`})})}),e.jsx(p,{span:12,children:e.jsx(n.Item,{name:[a.name,"precio_unidad"],label:"Precio",rules:[{required:!0,message:"Ingrese el precio por unidad"}],children:e.jsx(C,{style:{width:"100%"},min:0,placeholder:"Precio"})})}),e.jsx(p,{span:24,children:e.jsx(n.Item,{name:[a.name,"lavanderia_asignada"],label:"Lavandería",rules:[{required:!0,message:"Ingrese la lavandería asignada"}],children:e.jsx(k,{placeholder:"Lavandería Asignada"})})})]}),e.jsx(I,{type:"danger",style:{background:"red",marginBottom:"10px"},onClick:()=>u(a.name),block:!0,children:"Eliminar"})]},a)),e.jsx(n.Item,{children:e.jsx(I,{type:"dashed",onClick:()=>y(),block:!0,children:"Agregar Detalle"})})]})})})})},re=()=>{const{id:s}=f(),[r,x]=d.useState([]),[i,l]=d.useState([]),{reload:m,setReload:v}=A(),[b,g]=d.useState(!1);d.useEffect(()=>{w(s,x),q(s,2,l)},[s,m]),r.some(o=>o.estado===1);const h=[{key:"lavanderia_asignada",dataIndex:"lavanderia_asignada",title:"Lavanderia",align:"center"},{key:"producto",dataIndex:"producto_nombre",title:"Producto",align:"center"},{key:"color",dataIndex:"nombre",title:"Color",align:"center"},{key:"talla",dataIndex:"talla",title:"Talla",align:"center"},{key:"cantidad",dataIndex:"cantidad_enviada",title:"Cantidad",align:"center",sorter:(o,_)=>o.cantidad_enviada-_.cantidad_enviada},...r.some(o=>o.estado===3)?[{key:"cantidad_recibida",dataIndex:"cantidad_recibida",title:"Cantidad Recibida",align:"center"}]:[],{key:"fecha_envio",dataIndex:"fecha_envio",title:"Fecha de Envio",align:"center"}];return e.jsxs(e.Fragment,{children:[e.jsx(O,{dataSource:r,columns:h,rowKey:"corte_id"}),i===0||i===1?e.jsxs(e.Fragment,{children:[e.jsx(T,{style:{insetInlineStart:270},onClick:()=>g(!0),tooltip:"Añadir Corte"}),e.jsx(B,{openModal:b,closeModal:()=>g(!1),reload:()=>v(!m)})]}):null]})};export{re as default};
