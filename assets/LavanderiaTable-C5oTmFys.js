import{e as I,r as s,j as e,ai as S}from"./index-BmWU6D_k.js";import{a as k,b as L}from"./Lavanderia-Bnjt-Qif.js";import{f as w}from"./Corte-CYKnT9m1.js";import{a as A}from"./ApiClient-CULQ52Ii.js";import{F as n}from"./index-CRHOBmzH.js";import{M as E}from"./index-TD-6KXji.js";import{R as M,C as u}from"./row-BniTPEK9.js";import{S as j}from"./index-DkTDfaSE.js";import{T as C}from"./index-BBnmh3VH.js";import{I as P}from"./index-CWnVwJAY.js";import{B as y}from"./button-FicSlTbO.js";import{g as T}from"./Lote-Bl9cVKlX.js";import{F as q}from"./Table-Cbq78Rq0.js";import{F as O}from"./index-CFtlCFz4.js";import"./ContextIsolator-CDAbamh3.js";import"./useSize-C8agW3TM.js";import"./EllipsisOutlined-B9hgabmc.js";import"./useMergedState-hu-o9cEA.js";import"./index-D-PHtZF_.js";import"./responsiveObserver-JZknLzTk.js";import"./ActionButton-9LZ9Y4ui.js";import"./Skeleton-xnhcM5Bx.js";import"./TextArea-DI-TOUo6.js";import"./CheckOutlined-ItNP2_B5.js";import"./DownOutlined-YH-8aLNw.js";import"./EyeOutlined-HRnMiVRE.js";import"./styleChecker-CoLYYL8A.js";import"./addEventListener-Baxbb4oQ.js";import"./index-BT6oH27b.js";import"./LeftOutlined-DjgEGlNz.js";import"./Dropdown-CIamlYNK.js";import"./index-DO-3uIrf.js";import"./index-NOsMt7kP.js";import"./gapSize-U1swVQyS.js";import"./scrollTo-m78rnEY1.js";import"./useBreakpoint-lHdzJhA0.js";const R=async o=>{try{const r=await A.get("/color");o(r.data)}catch(r){console.error("Error al obtener colores por producto:",r),o([])}},V=({openModal:o,closeModal:r,reload:x})=>{const{id:l}=I(),[d]=n.useForm(),[m,v]=s.useState([]),[b,g]=s.useState([]),[h,i]=s.useState({});s.useEffect(()=>{w(l,v),R(g),i({})},[l,x]);const f=(c,_)=>{const p=m.find(a=>a.corte_id===_);p&&(i(a=>({...a,[c]:p.cantidad_restante||0})),d.setFieldsValue({detalles:d.getFieldValue("detalles").map((a,t)=>t===c?{...a,talla:p.talla}:a)}))};return e.jsx(E,{title:"Nueva Lavandería",open:o,styles:{header:{textAlign:"center"}},onCancel:()=>r(!1),onOk:d.submit,okText:"Añadir",centered:!0,width:550,children:e.jsx(n,{form:d,layout:"vertical",size:"large",labelAlign:"left",onFinish:async c=>{await k(l,c),d.resetFields(),x(),r(!1)},children:e.jsx(n.List,{name:"detalles",children:(c,{add:_,remove:p})=>e.jsxs(e.Fragment,{children:[c.map(a=>e.jsxs("div",{children:[e.jsxs(M,{gutter:{xs:8,sm:16,md:24,lg:32},children:[e.jsx(u,{span:12,children:e.jsx(n.Item,{name:[a.name,"corte_id"],label:"Corte",rules:[{required:!0,message:"Seleccione un corte"}],children:e.jsx(j,{placeholder:"Selecciona la prenda - talla",onChange:t=>f(a.name,t),children:m.map(t=>e.jsxs(j.Option,{value:t.corte_id,children:[t.producto," - ",t.talla]},t.corte_id))})})}),e.jsx(u,{span:12,children:e.jsx(n.Item,{name:[a.name,"color_id"],label:"Color",rules:[{required:!0,message:"Seleccione un color"}],children:e.jsx(j,{placeholder:"Selecciona el color",children:b.map(t=>e.jsx(j.Option,{value:t.color_id,children:t.nombre},t.nombre))})})}),e.jsx(u,{span:12,children:e.jsx(n.Item,{name:[a.name,"cantidad_enviada"],label:"Cantidad",rules:[{required:!0,message:"Ingrese la cantidad enviada"},({getFieldValue:t})=>({validator(B,F){return F>0?Promise.resolve():Promise.reject(new Error("La cantidad enviada debe ser mayor a 0"))}})],children:e.jsx(C,{style:{width:"100%"},min:0,max:h[a.name]||0,placeholder:`Máx: ${h[a.name]||"-"}`})})}),e.jsx(u,{span:12,children:e.jsx(n.Item,{name:[a.name,"precio_unidad"],label:"Precio",rules:[{required:!0,message:"Ingrese el precio por unidad"}],children:e.jsx(C,{style:{width:"100%"},min:0,placeholder:"Precio"})})}),e.jsx(u,{span:24,children:e.jsx(n.Item,{name:[a.name,"lavanderia_asignada"],label:"Lavandería",rules:[{required:!0,message:"Ingrese la lavandería asignada"}],children:e.jsx(P,{placeholder:"Lavandería Asignada"})})})]}),e.jsx(y,{type:"danger",style:{background:"red",marginBottom:"10px"},onClick:()=>p(a.name),block:!0,children:"Eliminar"})]},a)),e.jsx(n.Item,{children:e.jsx(y,{type:"dashed",onClick:()=>_(),block:!0,children:"Agregar Detalle"})})]})})})})},Ce=()=>{const{id:o}=I(),[r,x]=s.useState([]),[l,d]=s.useState([]),{reload:m,setReload:v}=S(),[b,g]=s.useState(!1);s.useEffect(()=>{L(o,x),T(o,2,d)},[o,m]),r.some(i=>i.estado===1);const h=[{key:"lavanderia_asignada",dataIndex:"lavanderia_asignada",title:"Lavanderia",align:"center"},{key:"producto",dataIndex:"producto_nombre",title:"Producto",align:"center"},{key:"color",dataIndex:"nombre",title:"Color",align:"center"},{key:"talla",dataIndex:"talla",title:"Talla",align:"center"},{key:"cantidad",dataIndex:"cantidad_enviada",title:"Cantidad",align:"center",sorter:(i,f)=>i.cantidad_enviada-f.cantidad_enviada},...r.some(i=>i.estado===3)?[{key:"cantidad_recibida",dataIndex:"cantidad_recibida",title:"Cantidad Recibida",align:"center"}]:[],{key:"fecha_envio",dataIndex:"fecha_envio",title:"Fecha de Envio",align:"center"}];return e.jsxs(e.Fragment,{children:[e.jsx(q,{dataSource:r,columns:h,rowKey:"corte_id"}),l===0||l===1?e.jsxs(e.Fragment,{children:[e.jsx(O,{style:{insetInlineStart:270},onClick:()=>g(!0),tooltip:"Añadir Corte"}),e.jsx(V,{openModal:b,closeModal:()=>g(!1),reload:()=>v(!m)})]}):null]})};export{Ce as default};
