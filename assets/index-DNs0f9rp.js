import{r as m,F as x,j as e,X as j,S as s,B as T,Z as E,I,b as M}from"./index-Bunp8VmX.js";import"./ApiClient-CwTlTqVt.js";import{g as P}from"./Tienda-iwZDkmbP.js";import{g as z}from"./Producto-BhDx9a2R.js";import{c as F}from"./MovimientosMercaderia-uXxdKJ4q.js";import{D as g}from"./index-B_8r9Za8.js";import{C as _}from"./index-BD1DMr01.js";import{C as N}from"./index-CWZRQiGq.js";import{T as R}from"./index-DokvF9RQ.js";import"./Skeleton-DQ75DhjH.js";import"./index-B00MmLCC.js";import"./Dropdown-CAg5ab4S.js";import"./styleChecker-BYYi54FN.js";const O=async i=>{try{const n=await(await fetch("http://localhost:3000/almacen_producto")).json();i(n)}catch(u){console.error("Error al obtener los productos del almacÃ©n:",u),i([])}},W=()=>{const{Title:i,Text:u}=R,[n,f]=m.useState({}),[d,o]=m.useState(""),[h,v]=m.useState([]),[b]=x.useForm(),[y,S]=m.useState([]);m.useEffect(()=>{O(v),P(S)},[]),m.useEffect(()=>{const t=p=>{p.key==="Enter"&&d.trim()!==""?(Object.values(n).some(l=>l.detalles.some(r=>r.codigo===d))?f(l=>{const r={...l};return Object.keys(r).forEach(a=>{r[a].detalles=r[a].detalles.map(c=>c.codigo===d?{...c,cantidad:c.cantidad+1}:c),r[a].cantidad=r[a].detalles.reduce((c,{cantidad:A})=>c+A,0)}),r}):z(d,"almacen_id",b.getFieldValue("almacen")).then(l=>{l&&f(r=>{const a=[l.producto_nombre,l.nombre,l.talla].join("-"),c=r[a]?r[a].detalles.reduce((A,{cantidad:D})=>A+D,0)+1:1;return r[a]?{...r,[a]:{...r[a],cantidad:c,detalles:[...r[a].detalles,{detalle_id:l.productoDetalle_id,codigo:d,cantidad:1}]}}:{...r,[a]:{producto_id:l.producto_id,color_id:l.color_id,talla:l.talla,cantidad:c,detalles:[{detalle_id:l.productoDetalle_id,codigo:d,cantidad:1}]}}})}),o("")):o(C=>C+p.key)};return document.addEventListener("keypress",t),()=>{document.removeEventListener("keypress",t)}},[d]);const k=t=>{f(p=>{const{[t]:C,...l}=p;return l})},w=Object.values(n).flatMap(t=>t.detalles).reduce((t,{cantidad:p})=>t+p,0);return e.jsxs(e.Fragment,{children:[e.jsx(g,{children:"GENERAR MOVIMIENTO DE MERCADERIA"}),e.jsx(x,{form:b,size:"large",labelAlign:"left",layout:"vertical",onFinish:async t=>{await F(t,n)},children:e.jsxs(j,{gutter:16,children:[e.jsx(s,{span:16,children:e.jsxs(j,{children:[e.jsx(s,{span:24,children:e.jsx(i,{level:3,style:{backgroundColor:"#181c34",textAlign:"center",borderRadius:"10px",color:"#fff",padding:"10px 0"},children:"Productos"})}),e.jsx(s,{span:24,style:{marginTop:"10px",fontSize:"1rem",textAlign:"center",color:"#333",maxHeight:"250px",overflowY:"auto"},children:e.jsx("div",{id:"productos_lista",style:{color:"white"},children:Object.entries(n).map(([t,p])=>e.jsxs(j,{gutter:[16,16],style:{margin:"10px 0",padding:"10px",backgroundColor:"#1e1e2f",borderRadius:"8px",alignItems:"center"},children:[e.jsx(s,{span:10,style:{textAlign:"left",color:"#fff"},children:e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold"},children:`${t}: ${p.cantidad}`})}),e.jsx(s,{span:6,children:e.jsx(T,{type:"primary",danger:!0,onClick:()=>k(t),style:{width:"100%",fontWeight:"bold",borderRadius:"5px"},children:"X"})})]},t))})}),e.jsx(g,{style:{margin:"15px 0"}}),e.jsx(s,{span:24,style:{fontSize:"0.9rem",color:"#555",display:"flex",justifyContent:"space-between",padding:"10px",backgroundColor:"#f7f7f7",borderRadius:"8px",fontWeight:"bold"},children:e.jsxs(u,{style:{color:"black"},children:["CANTIDAD TOTAL: ",w]})})]})}),e.jsx(s,{span:1,children:e.jsx(g,{type:"vertical",style:{height:"100%",borderColor:"#e0e0e0"}})}),e.jsxs(s,{span:7,children:[e.jsxs(_,{size:"small",title:e.jsx(i,{level:4,style:{color:"white",textAlign:"center"},children:"Datos del Envio"}),bordered:!1,children:[e.jsx(x.Item,{name:"almacen",label:"Almacen",rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(E,{options:h.map(t=>({value:t.almacen_id,label:t.nombre_almacen,key:t.almacen_id}))})}),e.jsx(x.Item,{label:"Tienda",name:"tienda",rules:[{required:!0,message:"Obligatorio"}],children:e.jsx(E,{options:y.map(t=>({value:t.tienda_id,label:t.tienda,key:t.tienda_id}))})})]}),Object.keys(n).length>=1&&e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsx(x.Item,{name:"guia",valuePropName:"guiaSI",children:e.jsx(N,{children:"IMPRIMIR GUIA"})}),e.jsx(T,{type:"primary",block:!0,htmlType:"submit",children:"Enviar"})]})]})]})})]})},B=()=>{const{Title:i,Text:u}=R,[n,f]=m.useState({}),d=Object.values(n).reduce((o,{cantidad:h})=>o+h,0);return e.jsxs(e.Fragment,{children:[e.jsx(g,{children:"GENERAR MOVIMIENTO DE MERCADERIA"}),e.jsx(x,{size:"large",labelAlign:"left",layout:"vertical",children:e.jsxs(j,{gutter:16,children:[e.jsx(s,{span:16,children:e.jsxs(j,{children:[e.jsx(s,{span:24,children:e.jsx(i,{level:3,style:{backgroundColor:"#181c34",textAlign:"center",borderRadius:"10px",color:"#fff",padding:"10px 0"},children:"Productos"})}),e.jsx(s,{span:24,style:{marginTop:"10px",fontSize:"1rem",textAlign:"center",color:"#333",maxHeight:"250px",overflowY:"auto"},children:e.jsx("div",{id:"productos_lista",style:{color:"white"},children:Object.entries(n).map(([o,h])=>e.jsxs(j,{gutter:[16,16],style:{margin:"10px 0",padding:"10px",backgroundColor:"#1e1e2f",borderRadius:"8px",alignItems:"center"},children:[e.jsx(s,{span:10,style:{textAlign:"left",color:"#fff"},children:e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold"},children:`${o}: ${h.cantidad}`})}),e.jsx(s,{span:8,children:e.jsx(x.Item,{style:{margin:0},children:e.jsx(I,{value:h.precio,onChange:v=>{const b=parseFloat(v.target.value)||0;f(y=>({...y,[o]:{...y[o],precio:b}}))},style:{borderRadius:"5px",textAlign:"center",fontWeight:"bold"}})})}),e.jsx(s,{span:6,children:e.jsx(T,{type:"primary",danger:!0,onClick:()=>eliminarProducto(o),style:{width:"100%",fontWeight:"bold",borderRadius:"5px"},children:"X"})})]},o))})}),e.jsx(g,{style:{margin:"15px 0"}}),e.jsx(s,{span:24,style:{fontSize:"0.9rem",color:"#555",display:"flex",justifyContent:"space-between",padding:"10px",backgroundColor:"#f7f7f7",borderRadius:"8px",fontWeight:"bold"},children:e.jsxs(u,{children:["Cantidad Total: ",d]})})]})}),e.jsx(s,{span:1,children:e.jsx(g,{type:"vertical",style:{height:"100%",borderColor:"#e0e0e0"}})}),e.jsxs(s,{span:7,children:[e.jsxs(_,{size:"small",title:e.jsx(i,{level:4,style:{color:"white",textAlign:"center"},children:"Datos del Cliente"}),bordered:!1,children:[e.jsx(x.Item,{label:"Nombre del Cliente",children:e.jsx(I,{})}),e.jsx(x.Item,{label:"Tipo de Pago",children:e.jsx(E,{defaultValue:"1",options:[{value:"1",label:"Efectivo"},{value:"2",label:"Yape/Plin"},{value:"3",label:"Transferencia"}]})})]}),Object.keys(n).length>=1&&e.jsx("div",{style:{marginTop:"10px"}})]})]})})]})},ee=()=>{const{user:i}=M();return e.jsx(e.Fragment,{children:i.rol==="administrador"?e.jsx(W,{}):e.jsx(B,{})})};export{ee as default};
