import{e as I,r as d,j as e}from"./index-DnZSuapv.js";import{b as k,c as S,e as L}from"./index-Ct-Inivb.js";import{a as w}from"./apiClient-DNqqoRi2.js";import{F as o}from"./index-eEjfzd7p.js";import{M as A}from"./index-CQoRxuqN.js";import{R as E,C as p}from"./row-Bgu54Vpq.js";import{S as j}from"./index-CAw0ik1A.js";import{T as y}from"./index-ZS8OVZkw.js";import{I as M}from"./index-CfhjOVlK.js";import{B as C}from"./button-DxAvYtf7.js";import{F as P}from"./Table-UylViyS0.js";import{F as T}from"./index-CRStyn0e.js";import"./index-OoAlQgr1.js";import"./EllipsisOutlined-BC2kcC9O.js";import"./useMergedState-xnIRtK6W.js";import"./useSize-DL9WfM8p.js";import"./ContextIsolator-X51Zuf7C.js";import"./index-BLOaBrrf.js";import"./Skeleton-C8RXkADb.js";import"./index-rbW2pF-2.js";import"./index-DnZuPcqL.js";import"./Tienda-DchRzPO6.js";import"./Usuario-BLIord41.js";import"./moment-64TmN0UP.js";import"./Lote-DgymCvQp.js";import"./responsiveObserver-P31G7zPC.js";import"./ActionButton-HZPJWirw.js";import"./TextArea-D6coABml.js";import"./CheckOutlined-CxFn5oU1.js";import"./DownOutlined-DfCZxesi.js";import"./EyeOutlined-Dgph3YEA.js";import"./styleChecker-BPMTEHVB.js";import"./addEventListener-BGVn8IVC.js";import"./index-nq-gG-E2.js";import"./LeftOutlined-DUJeaJ5E.js";import"./index-8gkIUhhz.js";import"./index-BsZC5oSy.js";import"./gapSize-U1swVQyS.js";import"./scrollTo-DvbmuEp_.js";import"./useBreakpoint-CHVb293n.js";const q=async s=>{try{const t=await w.get("/color");s(t.data)}catch(t){console.error("Error al obtener colores por producto:",t),s([])}},V=({openModal:s,closeModal:t,reload:u})=>{const{id:l}=I(),[n]=o.useForm(),[x,v]=d.useState([]),[h,b]=d.useState([]),[i,g]=d.useState({});d.useEffect(()=>{k(l,v),q(b),g({})},[l,u]);const f=(c,_)=>{const m=x.find(a=>a.corte_id===_);m&&(g(a=>({...a,[c]:m.cantidad_restante||0})),n.setFieldsValue({detalles:n.getFieldValue("detalles").map((a,r)=>r===c?{...a,talla:m.talla}:a)}))};return e.jsx(A,{title:"Nueva Lavandería",open:s,styles:{header:{textAlign:"center"}},onCancel:()=>t(!1),onOk:n.submit,okText:"Añadir",centered:!0,width:550,children:e.jsx(o,{form:n,layout:"vertical",size:"large",labelAlign:"left",onFinish:async c=>{await S(l,c),n.resetFields(),u(),t(!1)},children:e.jsx(o.List,{name:"detalles",children:(c,{add:_,remove:m})=>e.jsxs(e.Fragment,{children:[c.map(a=>e.jsxs("div",{children:[e.jsxs(E,{gutter:{xs:8,sm:16,md:24,lg:32},children:[e.jsx(p,{span:12,children:e.jsx(o.Item,{name:[a.name,"corte_id"],label:"Corte",rules:[{required:!0,message:"Seleccione un corte"}],children:e.jsx(j,{placeholder:"Selecciona la prenda - talla",onChange:r=>f(a.name,r),children:x.map(r=>e.jsxs(j.Option,{value:r.corte_id,children:[r.producto," - ",r.talla]},r.corte_id))})})}),e.jsx(p,{span:12,children:e.jsx(o.Item,{name:[a.name,"color_id"],label:"Color",rules:[{required:!0,message:"Seleccione un color"}],children:e.jsx(j,{placeholder:"Selecciona el color",children:h.map(r=>e.jsx(j.Option,{value:r.color_id,children:r.nombre},r.nombre))})})}),e.jsx(p,{span:12,children:e.jsx(o.Item,{name:[a.name,"cantidad_enviada"],label:"Cantidad",rules:[{required:!0,message:"Ingrese la cantidad enviada"},({getFieldValue:r})=>({validator(B,F){return F>0?Promise.resolve():Promise.reject(new Error("La cantidad enviada debe ser mayor a 0"))}})],children:e.jsx(y,{style:{width:"100%"},min:0,max:i[a.name]||0,placeholder:`Máx: ${i[a.name]||"-"}`})})}),e.jsx(p,{span:12,children:e.jsx(o.Item,{name:[a.name,"precio_unidad"],label:"Precio",rules:[{required:!0,message:"Ingrese el precio por unidad"}],children:e.jsx(y,{style:{width:"100%"},min:0,placeholder:"Precio"})})}),e.jsx(p,{span:24,children:e.jsx(o.Item,{name:[a.name,"lavanderia_asignada"],label:"Lavandería",rules:[{required:!0,message:"Ingrese la lavandería asignada"}],children:e.jsx(M,{placeholder:"Lavandería Asignada"})})})]}),e.jsx(C,{type:"danger",style:{background:"red",marginBottom:"10px"},onClick:()=>m(a.name),block:!0,children:"Eliminar"})]},a)),e.jsx(o.Item,{children:e.jsx(C,{type:"dashed",onClick:()=>_(),block:!0,children:"Agregar Detalle"})})]})})})})},fe=({status:s,reload:t,setReload:u})=>{const{id:l}=I(),[n,x]=d.useState([]),[v,h]=d.useState(!1);d.useEffect(()=>{L(l,x)},[l,t]),n.some(i=>i.estado===1);const b=[{key:"lavanderia_asignada",dataIndex:"lavanderia_asignada",title:"Lavanderia",align:"center"},{key:"producto",dataIndex:"producto_nombre",title:"Producto",align:"center"},{key:"color",dataIndex:"nombre",title:"Color",align:"center"},{key:"talla",dataIndex:"talla",title:"Talla",align:"center"},{key:"cantidad",dataIndex:"cantidad_enviada",title:"Cantidad",align:"center",sorter:(i,g)=>i.cantidad_enviada-g.cantidad_enviada},...n.some(i=>i.estado===3)?[{key:"cantidad_recibida",dataIndex:"cantidad_recibida",title:"Cantidad Recibida",align:"center"}]:[],{key:"fecha_envio",dataIndex:"fecha_envio",title:"Fecha de Envio",align:"center"}];return e.jsxs(e.Fragment,{children:[e.jsx(P,{dataSource:n,columns:b,rowKey:"corte_id"}),s===0||s===1?e.jsxs(e.Fragment,{children:[e.jsx(T,{style:{insetInlineStart:270},onClick:()=>h(!0),tooltip:"Añadir Corte"}),e.jsx(V,{openModal:v,closeModal:()=>h(!1),reload:()=>u(!t)})]}):null]})};export{fe as default};
